### Summary

I worked on all three main levels today. In the bus stop level, I added more static props (stop sign, mail box) and a throwable flare that ignites anything flammable and lasts about 120 seconds. In the fishing pier level, I added a scripted car that drives around and does damage if it hits you, and a crowbar weapon. In the spooky church level, I started building a weapon for the strange orbs.

I fixed an issue where interactive items would not stop shimmering if you walked outside their interaction radius while maintaining eye contact. The logic did not see a change of target and kept showing the effect. I added checks for a combination of colliding entity, whether it changed, and interaction radius before selecting/deselecting a target.

I moved melee weapon animation/path to player and zombie, removing the path variable from the melee weapon component. This makes it easier to make new melee weapons since they just need to be facing up with their handle at the origin. The player's swing path is now a sideways sweep that hits a greater area. I set up multiple swing paths and use the player's velocity to select between them.

I switched the player to an improved character controller (IKCC) so you can walk up curbs now. I also added a remote transform node that can target multiple nodes and be disabled through scripts, used for melee and ranged weapon targeting.

I split up rain and thunder effects for the player - thunder now has more and larger rain particles and they can be toggled separately.

### Progress

- bus stop level:
	- add more static props:
		- stop sign, mail box
	- add a throwable flare
		- next to the mail box
		- casts shadows
		- ignites anything flammable that it touches
		- lasts about 120s
- fishing pier level:
	- add a scripted car
		- drives around
		- does damage if it hits you
	- add a crowbar weapon (melee)
	- adjust some geometry to fix minor errors
		- make the cabin on the end of the pier walkable for players and navigable for NPCs
- spooky church level:
	- start building a weapon for the strange orbs
- bug fixes:
	- fix an issue where interactive items would not stop shimmering
		- if you walked outside of their interaction radius while maintaining eye contact, the logic did not see a change of target and kept showing the name/shimmer effect
		- check a combination of colliding entity, whether it changed, and interaction radius before selecting/deselecting a target
- features:
	- shuffle the order of the loading hints every time the loading screen appears
		- randomly shuffle the loading hints so they don't appear in the same order every time
	- move melee weapon animation/path to player and zombie
		- remove path from baseball bat
		- remove path from crowbar
		- remove path variable from melee weapon component
		- add horizontal swing path to player
		- add vertical/forward swing path to zombies
	- split up rain and thunder effects for the player
		- thunder now has more and larger rain particles
		- allows them to be toggled separately
	- switch player to an improved character controller
		- you can walk up curbs now
		- the IKCC controller extends the regular player entity, which in turn extends the character and the entity base
	- unequip thrown weapons when they run out of ammo
		- the flare and rock will be unequipped when they reach 0 ammo
		- currently this does not equip anything in their place
	- add a remote transform node that can target multiple nodes and be disabled through scripts
		- used for the melee and ranged weapon targeting: melee is enabled and following a path, ranged is disabled
- documentation:
	- add credit to camera script
	- add credit and license to IKCC script
	- add credit and license to shaders
- other:
	- clean up health system by splitting up damage and healing into separate subroutines

### TODOs

- [x] fix the orientation of the player's ranged weapon
	- may need to remove the remote transform or move the weapon marker for ranged
		- answer: a bit of both
	- could use two weapon markers for different weapon types
		- melee uses a path while ranged has a marker
- [x] add a way to return to the start menu
	- [x] from the end of level menu
	- [x] from the end game menu
	- [x] from the quit game menu
	- [x] unload the current level
	- [ ] prompt to save before returning
- [x] split up damage system to calculate total damage, total healing, and then apply to handlers for them
- [x] add thrown weapons as a subclass of ranged
- [x] unequip thrown weapons when ammo reaches 0
- [x] figure out how to toggle a remote transform or make a node that can do it
- [x] add a remote transform node that:
	- [x] takes a list of targets
	- [x] can use local or global transforms
	- [x] can reset to ready position when disabled
	- [x] has an active flag
- [x] disable shadow casting on flare smoke

### Next Up

- [x] add tab index to show menu method
	- [x] -1 for last visible tab/no change
- [ ] make melee weapons visible within the camera bounds at idle/resting position
- [x] add a shortcut to show the controls from the pause menu
- [ ] add a scripted car with variable speed curve
	- [ ] should have a wait timer that starts when it comes to a stop, which can be the shuffle timer
- [x] add a timer node that plays a series of values
	- [x] with an option to shuffle them every time it restarts
- [ ] make sure the player is always prompted to save before exiting
	- [ ] unless another confirmation is already up
- [x] make sure all of the UI buttons play the click sound
	- [ ] green and red buttons can play a different sound, or not
- [ ] move custom tools into a custom toolbar
- [x] set up some foliage sprites
    - [x] mix the Kenny sprites with a detail texture from the PSX bundles
- [ ] outline deep dives:
    - [ ] level building for map makers
    - [ ] weapon building for mod makers
    - [x] adaptive aim, why and how
- [ ] start splitting up readme into sections:
	- [ ] game features for mod makers
    - [ ] new nodes for Godot developers
    - [ ] systems for ECS developers
- [x] add an editor tool to verify the whole level structure

### Crowbar Collision Problems

I'm running into some problems creating the crowbar weapon: the collision shape for the physics body needs to be rotated, but the path follower rotates it to follow the path. This breaks the rotation on the collision shape node, causing it to be out of sync with the mesh and damage area.

I think the best way forwards with the least tech debt will be to move the swinging path to the player as a path follower or animation. That would allow me to give each character or monster its own animation (zombies could have a weak, slow swing) and remove it from the weapon, but that in turn would make it more difficult for a weapon to have its own custom swinging paths/animations. In most games, the weapon's movement will be controlled by the animations on the player model, but since I'm still using simplified shapes for this early version, those are not available yet.

What I would prefer, if it's possible, is for the player to have a weapon marker which can be animated by their skeleton and IK animations, and for weapons to attach swing paths depending on the player's velocity. This would provide different swings if you were moving in different directions (horizontal swings from left to right or vice versa, vertical swing if you are moving forwards and backwards). Having a library of preset paths to pick from would work for regular sized weapons with the most common animations, and special weapons could have their own paths. The weapon marker and attached weapon entity node should follow the path, with the arms following using IK.

#### Update 1:

I was able to cut and paste the swing Path3D nodes and curve points from the baseball bat and zombie melee weapons into the player and zombie scenes, which allowed me to reset the position and rotation to 0 for most of the nodes in the weapon scene for the baseball bat and crowbar. This makes it much easier to make new melee weapons, since they just need to be facing up (top to Y+) with their handle at the origin point of the scene. The player's swing path is a sideways sweep that hits a greater area than it used to and the zombie's swing path is unchanged, but now includes the flashlight on the worker zombie type.

The next step is to set up multiple swing paths and use the player's velocity to select between them. I think it would be a good developer experience to use markers set up around the player, normalize their distance into a direction, and then compare the current velocity to each of the markers. Each marker would be associated with a swing path, and the marker whose angle matched the player's velocity most closely would be used.

That does not address the question of weapons that add their own custom swing paths. Those are not a priority yet, but would be cool for heavy weapons with an alternate attack (hammer slam, for example).

#### Update 2

I set up a scripted remote transform node, since it seems like the original does not have a way to enable or disable it. This new node can move a list of nodes, which can be changed at runtime, and can be disabled. When it is disabled, the transformed nodes can be moved to a standby marker.

The standby marker can be used for a few things:
- for the weapon swing path, it is the ranged weapon placement
- for something like the scripted car, it could be the position where the car is stored when invisible (if its not really invisible)
- for doors, it can provide a small bump at the end of the motion

The player now has a custom remote transform to keep melee weapons in place while ranged weapons use adaptive aim. The current zombies are melee only, so it doesn't matter for them. The ranged zombies might need both, so they can bite up close and throw acid at a distance.

### Player Testing

I set up a checklist for player testing sessions and recorded what I learned from running through it.

Checklist:

- check the controls from the pause menu
- find the crowbar in the fishing pier level
- throw a rock in the spooky church level
- throw a flare in the bus stop level
- walk up a curb (fishing pier or bus stop)
- walk up some steps (fishing pier or spooky church)
- load a level, then navigate back to the start menu (any level)

Learnings:

- clarify pause menu
	- rename exit button to quit
	- and/or add a main menu button to the pause menu
- fix ramps in the church (front stairs, back carpet ramp) and fishing pier (beach, concrete stairs)
	- they are not walkable anymore, gravity prevents you from reaching the top
- fix stamina usage
	- sometimes not consumed while sprinting
	- can be consumed if the player is sliding downhill on the beach
- reset player on new game
	- reset the player's health, inventory, etc
	- or find a way to reload that scene entirely
- you can throw the rocks at the spooky orbs and they will move around
