### Summary

A lot of general work paying down tech debt around the inventory handling in order to add containers. Along with that, I implemented item shortcuts (using the number row to select certain weapons). These shortcuts are a bit of data in the ECS world, so developers can set the shortcut for each item as they create it.

Voice audio is now split up into its own bus, separate from menu audio, so that the dialogue audio and menu background audio can be set individually. There is a new CLI option to set the log level (`--log-level`) and some code to automatically detect the best default log level based on how the game was built. Debug builds use debug level, release builds use info level.

There is an action node for trigger areas to add or remove stamina from characters, or disable stamina recharge while they are inside the area. This will be used to prevent stamina from recharging underwater or in certain scary areas.

The inventory work was needed to support containers and fix a lot of hacks in the player system. Zombies now hold their arms down at their side when not equipped and raise them up horizontally when they are chasing or attacking. This work allowed me to add a wooden crate to the fishing pier level that has a shotgun inside it.

I fixed the pistol sounds - it had been copied from the shotgun and was using the same sounds. I also debounced the preview sounds in the options menu so they only play after the slider has been released.

### Progress

A lot of general work paying down tech debt around the inventory handling in order to add containers. Along with that, I implemented item shortcuts (using the number row to select certain weapons). These shortcuts are a bit of data in the ECS world, so developers can set the shortcut for each item as they create it. Voice audio is now split up into its own bus, separate from menu audio, so that the dialogue audio and menu background audio can be set individually. There is a new CLI option to set the log level, `--log-level`, and some code to automatically detect the best default log level based on how the game was built. Finally, there is an action node for trigger areas to add or remove stamina from character, or disable stamina recharge while they are inside of the node.

The inventory work was needed to support containers and fix a lot of hacks in the player system, but it also came with improvements to how the NPCs equip their weapons. Zombies now hold their arms down at their side when not equipped and raise them up horizontally when they are chasing or attacking, combined with the arms-forward attacking animation. This work allowed me to add a wooden crate to the fishing pier level that has a shotgun inside it. Interacting with the crate will give you the shotgun.

- new features:
	- implemented item shortcuts
		- the number keys 1-0 are now item shortcuts for the first 10 weapons, while the heal key is treated as an item shortcut for healing items
		- shortcuts are assigned in the item components, so custom shortcuts could be persisted (if customization were implemented)
	- implemented containers (and generally improved inventory handling)
		- this relies more on the inventory relationships and continues to decouple the inventory logic from the player service, so that it can be applied to NPCs and containers in the world
		- replaced the previous inventory node with a more specialized one that pairs with an ECS component, where count and weight limits are set
		- the current weapon and equipment is now tracked in a persistent way
		- a node is still required to hold the entities, since they are also nodes, but this one now cooperates with the ECS component
		- added a marker where containers and characters will drop their items, which can be customized
	- added underwater sound effects in the fishing pier level
		- when you are under water, sounds will be muffled and distorted
	- added an audio bus for voices
		- will be used to separate spoken dialogue from the menu background sounds and NPC dialogue from environment/zombies
		- zombies moaning and groaning will still be on the effects bus
		- has its own slider in the volume menu
	- added a stamina action for trigger areas
		- trigger areas can now drain stamina, recharge stamina, and/or disable stamina recharge while inside the area
		- will be used to prevent stamina from recharging underwater or when you are in certain scary areas
	- added a CLI flag to set the log level
		- `--log-level` will now set the log level to help players provide more detailed bug reports
	- set the log level depending on the build type
		- debug builds will use debug level
		- release builds will use info level
- bug fixes:
	- added unique sounds to the pistol
		- the pistol had been copied from the shotgun and was using the same sounds
		- switched to unique sounds when you equip it, fire it, and reload it
	- debounce the preview sounds in the options menu
		- when adjusting the volume in the options menu, the sounds will only play after the slider has been released
		- fixes the issue where sounds would restart repeatedly while the slider was being moved

### TODOs

Done.

### Next Up

- [x] in the check level structure tool:
	- [x] make sure no entities are outside of the entities node
	- [x] check for components with weird node paths that would lead outside of the scene and then back to the root, like `Node not found: "../WeaponShotgun/Shotgun`
- [x] fix the "Unable to equip weapon: ZombieMelee" log spam
	- [x] they keep trying to equip their melee weapon even when it's already equipped
- [x] weapon scrolling can get stuck when you have the rocks and pistol
	- don't have much more info on this one yet, need to work on the repro
- [x] update ammo label after equipping an item through the inventory menu
	- there are a few places where equipping or switching items does not update the ammo label correctly
	- make fishing pier larger
	- extend the road so that the car is always on it
	- add a door on the balcony
	- add portals to the spooky church and bus stop levels
	- add a phone book that opens the level select
	- add a red save page to spooky church

### Ideas

- containers that are permanently locked except for the owner
- display the level select on a screen in a scifi level with left and right buttons
- push input into a subviewport (scroll the level select menu)
- test if dictionary has is faster than getdictionary get

### Inventory and Containers

I needed to clean up how inventories work before I could implement containers in the world.

- usecases:
	- player inventory
	- locker with weapons
	- ammo containers
- goal:
	- clean up how player inventory is managed
		- inventory is represented in two ways:
			- the `Holding` ECS relationship
			- the `inventory_node` on `ZE_Character` entities
		- restrictions on the inventory:
			- the entities within it need to continue existing in the ECS world
			- ideally the nodes for those entities would exist as well
			- everything needs to be invisible unless marked otherwise/equipped
			- physics needs to be disabled
		- needs to be easy to find the items, weapons, etc
		- should probably be its own node type
	- add support for basic transfer-everything containers
		- can contain multiple items
		- everything that you can pick up will be transferred on interaction
- idea:
	- inventory node + component, with the component acting as the parameters for the node
		- the node is needed to hold the entity nodes
		- the component is passed to calls and has the weight limit, count limit, etc

- [x] add an inventory component
- [x] add an inventory node
- [x] replace references to `inventory_node` with a component lookup
- [x] replace references to `current_weapon` with a relationship lookup
	- [x] done everywhere except for the next-weapon/previous-weapon handlers
		- any concept of "next" and "previous" relies on the position in the list
		- fetching a list of weapons is easy, and sorting it is not much harder, but what defines the order?
		- if the character has multiple weapons equipped, do they all switch?
		- next and previous should be defined using the numeric shortcut buttons, or at least the order of the item shortcuts
		- number bar referred to as item shortcuts
		- items need a shortcut component, which would allow custom shortcuts to persist
		- pressing a shortcut button multiple times will scroll through the items assigned to that shortcut in alphabetical order - v2
		- shortcut observer watches the input component and responds to changing use_shortcut values?
		- scrolling between shortcuts requires storing the current shortcut number
		- except that number is already stored in the equipped item
		- so fetch the equipped item, get the shortcut component with index, increment within the enum, find that item, and equip or use it
		- this allows for food and med
- [x] support dropping non-weapon items
- [x] add a drop point where items will be dropped, otherwise they appear in front of the character
- [x] add nested inventory items to the world when the parent is ready
	- already done, but uses a general node check rather than searching the inventory specifically
- [x] make sure zombies equip a weapon when they enter chase mode
- [x] add flags to inventory to allow-add/allow-remove
- [x] add inventory interaction that transfers everything with menu messages
- [x] add a crate containing items to the world and test it
