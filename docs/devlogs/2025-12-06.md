### Summary

I ran into and fixed some entity removal bugs, particularly around event handler ordering. The objective system is now working for simple single-objective trees, with partial support for optional and parallel objectives.

I started breaking up the menu scene into sub-scenes and added keyboard shortcuts for the inventory and objective menus. I also started designing the cinematics system for cutscenes and scripted sequences.

### Todos

- hotel pool stairs
- add health to survivors
- ranged weapon fire effect
- critical hit areas for zombies
- fix explosion sounds by ?

### Ideas

- armor with weapon immunity
  - makes you resistant to basic zombies

### Entity Removal

Removing entities from the ECS world continues to be fraught with peril. This time, the key type on-interact handler was removing the key entity from the ECS world before the objective completion handler could run, which then caused the filter query that runs before each observer to discard the event, because no matching entities were found. This was bypassed by placing the objective handler before the key handler, or more generally, non-removing handlers before removing ones. This is a good indicator that the interaction logic needs to be cleaned up, and handlers should probably return a boolean to abort the sequence and prevent the rest from running.

The sound bugs related to entity removal have yet to be fixed. Moving the sound node to the entity's parent would probably work, and hiding the entity until the sound is finished does not work well, since scripts on the entity continue to run. Changing the sound's parent is relatively safe here, since it will no longer be moving once it has been removed.

### Objectives

The initial objective system is implemented and working, for simple single required objective trees. It does not have full support for optional or parallel objectives yet. Since children are activated when the parent has been completed, spread-and-collect is not supported yet. Optional objectives can only have optional children, but that should be fine.

Since the objectives are part of the level and are not components, they need to be saved separately from the ECS world. It is also important for objectives to be saved between levels, so structuring the save files by level, then entities and objectives within each level:

```yaml
save: {
  name: "",
  levels: {
    "1": {
      entities: [],
      objectives: {},
    }
  }
}
```

Objectives should have actions, like "activate portal" or "remove entity", so they can unlock new parts of the world and make new interactions possible.

### Menus

The menu scene needs to be broken up into sub-scenes for each menu, which can have an update method or on open/on exit hooks to update their contents. The inventory and objective menus especially need this, since they build complex data structures and/or run ECS queries to update their contents. Showing a menu should probably update it before it becomes visible (or in the same frame).

Shortcuts have been added for the inventory and objective menus, since you may want to see those without needing to click through the pause menu every time. The game still pauses for now, to prevent mouse look from being active, but it would be interesting to have the game continue running while you are in the inventory menu (at least, maybe objectives too). Most of the Souls genre does that and it increases the suspense, plus it works better for multiplayer.

### Sounds

This is a followup on the sound cutoff bug from yesterday. I figured out how to keep sounds playing after their parent entity has been removed.

The easiest way to keep sounds playing is to attach them to the entity's parent at the same position and remove it after it's done playing. If the sound was part of the explosion scene, it would appear at the right time and exist after the barrel. The gunshot sound can be linked to the muzzle flash the same way, but the weapon component won't be able to reference them as a node.

### Cinematic Cutscenes

Any cutscene or scripted sequence falls under the cinematics part of the level. Cinematics can start on a trigger, randomly, or loop. They can have a maximum number of plays or loop forever.

Examples:

- intro with truck driving into hotel parking lot
- cars driving down the road
- deer running through the woods
- car running into wall and catching fire

Nodes:

- cinematic? Or animation player?
- triggers
- entity tween path
