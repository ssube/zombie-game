### Summary

I added a flag to the interactive component for whether items can be picked up. This fixes buttons in the debug level that were disappearing after interaction because they were being activated as buttons, then picked up as items.

I added zombies to the bus stop, fishing pier, and spooky church levels. I also added a magnum pistol (revolver) weapon with pistol bullets.

I fixed several bugs: the sparkle crown and other hats were not showing up in the inventory list because items that were picked up did not have the Holding relationship. The exploding barrels were not throwing traffic cones because they were on the wrong collision layer. The flashlight toggle was broken because the equipment system change broke a hard-coded node path - I switched it to use an ECS query for inventory items with a Light component. The crosshairs were not changing color when highlighting interactive items - I added a color property to the interactive component with a standard color palette for core item types.

I extracted the actor-item interaction code from the player system into InteractionUtils. This is the foundational step for allowing other characters to interact with items the same way the player does. Interactions are set up in a dictionary with an interaction name as the key and a 2-tuple of condition and handler. Multiple handlers can run on the same item and handlers can stop the chain of execution.

I added an editor tool to generate diagrams from UI scenes with labeled boxes, used to produce the HUD reference in the Options menu. I also replaced the nerf bullets with real bullet meshes and added fog to most of the environments.

### Progress

- features:
	- added a flag to the interactive component for whether items can be picked up
	- added zombies to the bus stop, fishing pier, and spooky church levels
	- added a magnum pistol (revolver) weapon
	- added a pistol bullet
- bug fixes:
	- the sparkle crown, traffic cone, and other hats were not showing up in the inventory list
		- items that were picked up did not have the `Holding` relationship used to populate the list
	- the exploding barrels were not throwing the traffic cones
		- the traffic cones were on the wrong collision layer (world instead of props) and were moved to the correct layer
	- the flashlight toggle no longer works
		- the change to use the equipment system for the flashlight broke it, because the code had a hard-coded node path
		- switched the flashlight handler to use an ECS query for inventory items with a new `Light` component
		- this adds support for multiple flashlight items in different slots, in theory
	- the crosshairs were not changing color when highlighting an interactive item
		- this broke while I was refactoring the interactions
		- added a color property to the interactive component, so that each item can have its own color
		- set up a standard color palette for the core item types
	- the buttons in the debug level were disappearing after interaction
		- they were being activated as buttons, then picked up as items
		- there was a fallback interaction handler for picking up items that could not be equipped
		- added a flag to the interaction component for whether an item can be picked up or not
	- the equip/unequip buttons only appear when they are valid for the selected item(s)
		- if the items cannot be equipped, equip should remain disabled
		- if none of the items are currently equipped, unequip should remain disabled
- improvements:
	- changed the name of the shotgun ammo from `12gauge` to "12 Gauge" to be more readable
		- the ammo component does not differentiate between key and display name at the moment
		- I may need to add a dictionary of display names somewhere later
		- if using a string for each ammo type ever becomes a memory or performance problem, they may need to be switched to an enum
	- extracted the actor-item interaction code from the player system
		- tl;dr: this is the foundational step for allowing other characters (survivors and zombies) to interact with items in the world the same way that the player interacts with them
		- many interactions no longer assume that the actor is a player
		- makes it much easier to add new interactions later
		- some implementation details:
			- interactions are set up in a dictionary with an interaction name as the key and a 2-tuple of `[condition, handler]` to check if each handler is applicable
			- multiple handlers can run on the same item, if applicable
			- handlers can stop the chain of execution, preventing any more handlers from running (for ammo or food that is consumed)
	- replaced the nerf bullets with real bullet meshes
		- the shotgun now launches a whole shotgun shell, but I don't have a buckshot mesh and spheres that size are hard to see
	- added fog to most of the environments
		- day, night, and spooky church all have fog now
- editor tools:
	- added an editor tool to generate diagrams from UI scenes
		- generates a simple diagram with labeled boxes
		- uses the `diagram_label: String` and `diagram_outline: Color` meta fields on the controls
		- boxes show the outline of each control in the `diagram_outline` color
		- boxes have a centered label using the `diagram_label` text
		- saves the diagram to a PNG
		- used to produce the HUD reference in the Options menu

### TODOs

- [x] barrel explosions are not throwing the traffic cones
	- increasing the explosion's impulse multiplier only throws the barrel further, not the cones
	- actions are only running for the barrel and the shotgun
	- the traffic cones were part of the world collision layer, which is excluded from the barrel explosion and wrong for the cones
	- moved the cones to the props collision layer, which is where the barrel explosion is too
- [x] check if the flashlight toggle still works as an equipped item
	- it does not
	- fixed using ECS
- [x] display names for ammo types
	- show "12 Gauge" instead of `12gauge`
	- the easiest solution will be to change the type name to the display name, which I don't like but it's not an enum
	- should it be an enum with string names?
		- using an enum is probably good for performance, but will be a larger refactor at this point and not needed to make this change
	- since the labels are data, I'm going to update them without any code changes for now
- [x] fix crosshair colors when looking at interactive items
	- [x] move colors into a ~~table~~ component somewhere
	- [x] add logic to the raycast handler in the player system
	- add an option to the options menu to disable the dynamic colors and/or set a custom one - v2
- [x] some of the buttons in the debug room are disappearing
	- the button entities are being removed after they have been activated
	- both the `use_button` and `pickup_item` interaction handlers are being run, because pickup_item assumes that any interactive item can be picked up, which is not true
	- I don't think the general `pickup_item` handler makes much sense, because at the moment, it will only pickup things that do not match any of the item traits/components
	- commented out the `pickup_item` interaction handler for now
- [x] reduce debug button sound volume
- [x] add a flag for whether items can be picked up or not
- [x] finishing touches for the demo
    - [x] more zombies:  in the water, on the beach, on the road, behind the church, on the road again, between the buildings
	    - [x] bus stop
	    - [x] fishing pier
	    - [x] spooky church
	- [x] zombies are too slow
	- ~~jumping is broken - maybe~~ seems to be working
	- [x] adaptive aim is not working well or at all
	- [x] add fog to the spooky church and bus stop
    - [x] play testing guide: find X, use Y, do Z in the menus
    - [x] another ranged weapon, maybe a pistol (2 thrown, 2 melee, 1 ranged)
    - [x] document what won't be part of the game - crafting, base building
- [x] real bullet graphics
	- [x] replace the nerf blob with a real bullet model
- [ ] itch prep
	- [ ] banner art
	- [x] page style
	- [ ] link to github
	- [ ] recorded demo
	- [ ] note about demo levels
- [x] fix the equip button
	- [x] when equip amd unequip show
- [x] made a hud diagram
	- [x] generated from scene if possible
- [x] spruce up the readme
	- [x] emojis
	- [x] critical hits/headshots in features highlights list
	- [x] examples of ECS components and systems available for other projects to reuse

### Next Up

- fix the zombies!!!
	- they are slow and don't turn to face the player reliably
- [x] export a working bundle with necessary textures + audio
	- may require moving the assets that are being used into a new directory
	- exporting selected resources does not produce a working bundle, addons are broken
	- excluding selected resources does run, but assets and sounds are hard to sort through
- [ ] prepare the list of resource credits for the demo
	- [ ] freesound effects
	- [ ] itch assets
	- [ ] opengameart textures
	- [ ] editor icons
	- [ ] whatever else needs to be included
- [x] convert mp3 and wav sounds to ogg
	- [x] make a script for it
- find and fix the FBX error
	- can't repro anymore
- write tests
- make the itch page public
- [x] put yes/no/back buttons in a consistent hbox
- function to recreate entity from prefab
	- used to recreate the player between games
- spatial index
	- index types: 2D / 3D, momentary / temporal
	- static and moving regions
	- query types:
		- entities within region (within AABB)
		- entities within distance (within sphere)
		- point within entities (either AABB or sphere)
	- when and how is this better than using an area?
	    - it combines spatial queries with components
	    - it uses a geometric tree for indexing
	    - it stores references to the existing components and takes up very little memory

### Sparkle Crown not showing up in inventory menu

I found a bug where some items were not appearing in the inventory menu after being picked up.

- the pickup item handler is not adding a holding relationship
	- fixed by adding the relationship in the handler
- the inventory menu is using the current weapon and inventory nodes to list items, not the relationships
	- fixed by using the relationship for the menu
	- that somehow caused rocks to show up twice
		- they have two holding relationships, but only show up in the pickup_item and use_weapon handlers
		- both of those are running when picking up a weapon, because there is nothing to stop the chain of interaction handlers
		- I have considered adding a bool or enum response to handlers, so they could handle-and-stop
		- it would also be nice to put the handlers into a list or dictionary of [Component, Callback]
			- this would need to include the crosshair color somewhere, or the callback would
			- this should all be set up in the interaction utils

### Interaction Helpers

- setting up the InteractionUtils class as a switchboard of handlers for various components, extracted from the player system
- goals:
	- extract from the player system so that any character can use them
		- some interactions are only usable by players, like keys
	- make the handler signature more consistent
		- most handlers are `(target: Entity, player: Entity)` but some use `(target: Entity, player: CharacterBody3D)` and even stranger signatures
	- allow handlers to abort/finish the chain
		- some handlers will remove the entity or add it to your inventory and need a way to prevent any others from running
		- returning some enum value would provide multiple options for how to handle the rest of the chain
	- ???
	- profit
- TODOs:
	- set up utils
	- define the structure for handlers
	- define an enum for handler return values
	- turn the `has_component` checks into test callbacks
	- move any `set_crosshair_color` parts back into the shimmer code, not the handlers (the crosshair should change when you highlight the item)

Problems:

- FIXED: the gun is not being held
	- it was being processed as ammo too because it returned CONTINUE rather than STOP
- FIXED: the flashlight is not being equipped
	- fixed interaction order, equipment stops pickup
- FIXED: the hat is not being equipped
	- same as above
- FIXED: the ammo label is not being updated when you equip ammo/gun
	- update after every interaction?
- FIXED: the shimmer target tracking is bad
	- it was always kind of broken
	- moved to each entity
	- checked for validity when those entities are processed
	- TODO: should this be run before interactions or after?
- FIXED: the next/previous weapon is only picking the shotgun, not the bat
	- the next/previous input handlers were relying on the order of nodes in the player's inventory, which is a terrible method
	- get the weapon list and use the current weapon's index in that
	- TODO: still using the current_weapon node rather than the equipped relationship
- FIXED: the ammo label does not update when you switch next/last weapon
	- fixed by updating the label after switching
- FIXED: equipping an item through the inventory can equip two of them overlapping
	- it's because different weapons use different slots, melee vs ranged, so the current rules allow both to be equipped together
	- calling through equip_weapon should be a viable workaround for now, but weapons shouldn't be equipped differently from other things, so some kind of mutually-exclusive slot system will be needed
