### Summary

Today was a busy day working on other projects, with an upgrade to my network storage in progress and some chores around the house to wrap up before winter vacation ends.

I added a very basic logger to reduce log messages during gameplay. It waits to format the message string until it knows the line will be printed. I replaced all calls to print, printerr, push_warning, and push_error.

I added an ECS system for path followers. These are built into Godot but don't run themselves or work with ECS. The system has an option for making the entity look ahead along the path. This allows the scripted car and seagull entities to be the root nodes for their own scenes.

I fixed the zombie bugs. Chase was broken because when I refactored attention, everything was writing to the attention position but nothing was reading from it. I adjusted the movement to set the nav path and movement position, making their movement much more confident. The zombie's melee weapon had been positioned poorly so it was inside their body most of the time. I adjusted the placement, made sure zombies always equip their weapon before attacking, and added little arms to the weapon.

I added variable pitch and volume for sounds, which made the footsteps much more believable and easier to listen to.

I fixed the stamina regen bug by switching to use the physics body velocity instead of the velocity component. The velocity component was including the downward force from gravity, but using the post-collision velocity makes stamina regen much more predictable when standing still on sloped surfaces.

### Progress

- feature: set up the config for the vscode godot debugger
	- added vscode launch config
	- you do need to launch it from within vscode
- feature: added a very basic logger
	- needed more log levels than `print()` / `printerr()` could provide
	- set up as a singleton, no namespaces or subloggers or other fancy stuff
	- replaced all calls to: `print`, `printerr`, `push_warning`, `push_error`
- bug fix: fixed the level name in the `Level loaded` message
	- now uses the level title instead of the unique key
- feature: added an ECS system for path followers
	- mimics the engine's PathFollow3D feature with ECS components
	- works with any static body entity
	- allows multiple entities to follow paths in the level
	- entities can be offset to avoid colliding with each other on the path
	- entities can look ahead on the path for smooth rotation during movement
	- this allows the scripted car and seagull entities to be the root nodes for their own scenes, which means their extra components are available again
- bug fix: fixed the mesh UID error for the red car (used in the bus stop level)
- bug fix: improved the zombies
	- fixed their attack
		- the damage area of the zombie melee weapon was placed incorrectly and usually inside of the zombie's body
			- added arms to the weapon and moved the damage area to the end with the hands
		- the zombie melee weapon was never being equipped correctly
			- equipped the weapon before each attack
	- increased the angle of their vision cone
- feature: apply zombie damage skin to their arms
	- applied in observer
	- the `find_children("*")` pattern skips over nested scenes that do not have editable children
	- setting the `owned` parameter to `false` fixes this
- bug fix: stamina getting stuck at 0
	- the stamina system is seeing velocity with Y < 0 due to gravity/slopes/sliding
	- that movement triggers the moving recharge rate
	- but the stamina cost of the movement is greater than the moving recharge rate
	- so stamina stays at 0 forever
	- use physics velocity if it exists
- feature: added variable pitch and volume for sounds
	- used on the player and zombie footsteps
	- this is a new node, reusable for any sounds and supports subtitles
- fix: make sure all sounds are on the right bus
	- this makes the volume sliders work on the correct sounds
	- spoken dialogue (of which there is none, yet) is on the menu bus, but voices may need their own bus

### TODOs

- bug: player character sometimes struggles to get up a curb
	- sometimes they can climb the curbs in the fishing pier and bus stop levels, sometimes they cannot
	- player is using a collision capsule, not a cylinder or box
- feature: ranged attack zombie
    - needs AI to stand back and fire
    - needs acid blob weapon
- lint: replace the `node.get_node(".") as Node3D` pattern with `as Node as Node3D
	- doesn't work as well if the goal is `Node3D` without an intermediate `if node is Type`

```
func _get_body_velocity(entity: Entity) -> Vector3:
	var node := entity as Node
	if node is RigidBody3D:
		var physics_body := node as RigidBody3D
```

### Next Up

- [x] set log level to debug in debug builds
- [x] inventory and containers
- [x] add sound effects underwater

### Ideas

- [x] prevent stamina recharge in an area
- split stealth effects and combat effects into two audio buses?
- [x] add an audio bus for voices?
- add a way for props to play an animation when the weather changes
	- flags flapping in the wind

### Zombies

The zombies were broken. Not great for a zombie game.

- fix zombie behavior
    - problems:
	    - frequently lose sight, have ever since adding their weapon
	    - move very slowly
    - findings:
	    - the zombies do turn towards the player and move, but not immediately - it seems like they finish their previous state before moving to attack
	    - attack does not have good reach and no visual indicator
		    - little stubby zombie arms
			- zombies are not equipping their weapons, so they don't follow the weapon marker or the attack animation
			- forced the zombie to equip their weapon before every attack and now they throw their arms at the player correctly
		- seems like they are getting stuck between states and waiting for one to finish before reacting to triggers
			- chase logic might be wrong
			- a few different code paths will set the attention target position, but none of them transfer that into the movement target position
			- updated the chase action to set the attention and movement targets to the same position

### Variable Pitch Footsteps

I added a node to play noises at varying pitch and volume, and it made the footsteps so much more believable and easier to listen to.

### Stamina Regen Fix

This is a little bit of a workaround, but I switched the velocity that is used to select the moving or still stamina recharge rate, using the velocity of the entity's physics body if it has one. This will remove the applied gravity that was causing the problem. You can think of the velocity component as desired velocity or pre collision and the physics velocity  is the actual, post collision value. I need to make sure those gravity values, but if the velocity component is including the downward force, then using the post-collision velocity should be equivalent to using the horizontal component from the velocity component. Either way, this makes stamina regen much more predictable when standing still on a sloped surface.
