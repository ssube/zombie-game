### Summary

I did some performance work on the zombie AI today. I optimized the zombie detection scripts by enabling the zombie's vision check only when someone is within their detection area. I also switched the vision cone from mesh sampling to center sampling.

I fixed a trigger area bug that was spawning zombies every few seconds. With 30+ zombies in the same room, the game started to lag. Moving level geometry from the vision cone mask to its environment mask helped a lot.

I made some changes to the trigger area to track current colliders and use real timers for intervals. This allows effects like "make all enemies in this area aggressive when the player enters" and fixes an issue where intervals were not being cleared if a body was removed from the world.

I fixed footsteps playing all at once when the game was unpaused by switching the footstep system from wall time to delta time. I also fixed the river water surfaces in zone 1, fixed the zombie wander AI not resetting the timer, and added logic to recursively register children when a character is added.

I renamed the awareness component to attention and started defining a scoring system for zombie aggro.

### Progress

- switch some system messages to regular logs rather than debug
	- the stack frame printed with debug messages was not helpful, since it was always the same line within the `ZG_World` script
- some changes to the trigger area
	- give the trigger area an option to keep track of current colliders
		- this allows effects like "make all of the enemies in this area aggressive when the player enters it"
	- use real timers to add area and body intervals
		- this fixes an issue where intervals were not being cleared if a body was removed from the world
- optimized the zombie detection scripts
	- enable the zombie's vision check when there is someone within their detection area and disable otherwise
	- switch the vision cone from mesh sampling to center sampling
- remove some `x is ZE_Entity` checks, which is the wrong way of identifying how an object should respond to interaction or other triggers
- fixed the zombie wander AI not resetting the timer when it picked a new destination
- added logic to the ZE_Base entity to register any children
	- this will recursively register weapons and inventory items when a character is added
- fixed the river water surfaces in zone 1 that are parallel at the end of each water brush
	- changed them to `skip` texture in Trenchbroom, they no longer show up in Godot
- fixed footsteps playing when the game was unpaused
	- after pausing and unpausing, footsteps would all play at the same time
	- switched the footstep system from wall time to delta time, so it pauses correctly
- removed the unused vision component
- rename awareness component to attention, start defining scoring system

### TODOs

- copy devlogs into github
- start setting up itch page

### Next Up

- add explosion decals to barrels
- [x] figure out melee impact sounds
- add support for multiple weapon muzzle markers
- [x] figure out aggro system for zombies
    - doubles as flee system for animals in the tutorial
    - score accumulates as the zombie sees and hears things
    - high enough score causes horde behavior
    - in zombies, seeing a zombie with high aggro will head towards them
    - in animals, they will run away from the source or each other
- write deep dive on extra components
- clean up zombie death sequence
	- add ragdoll action node to unlock physics
- record a demo with sound
- add a stick melee weapon
- [x] add a rock throwing weapon
- implement armor and healing screen effect
- include bullet type when looking up decals, like `bullet_wood` or `rocket_stone`

### Zombie Performance

With more zombies in the level, I started hitting performance issues and needed to optimize the detection scripts.

- trigger area had a bug and started spawning zombies every few seconds
	- with 30+ zombies in the same room, the game started to lag
- most of the lag was caused by the vision cone checking multiple bodies
	- moving level geometry from the vision cone mask to its environment mask helped
	- fixing the trigger area bug helped a lot
- changed entity to only enable the zombie vision cone when there is at least one character within the detection area
	- on enter, vision cone starts monitoring and counter increments
	- on exit, counter decrements and if the counter reaches zero, the vision cone stops monitoring
- scripts are currently running in 0.6-0.9ms on my dev machine (a mini PC)
- skip the exit save prompt when you are already in the game over menu
- clean up the screen effects
    - relationship is no longer removed on the first frame
    - effects keep applying until removed
    - max strength is used from all available effects

### Screen Effects

I ran into some problems with how screen effects are applied and removed. The relationship-based system has some quirks.

- the screen effect relationships are removed after the first frame to prevent repeated tween in
- using a dict or list of timers would work for fading out, but not fading in
	- to fade in, you need to know how long the effect has been applied
	- I don't really want to have timers that count up and down at the same time, in the same component
- relationships make it easy to add effects, but how to remove ones that no longer apply?
	- they won't show up in the relationship scan, but still need to be 0
- filling the effect strength dictionary with 0 works, but seems slow to set every effect on every frame
