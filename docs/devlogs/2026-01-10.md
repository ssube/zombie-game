### Summary

I had a few bugs to fix today and a few ideas to figure out, like the phantom baseball bat showing up in the player's aim and setting up a scene for loading shaders and effects ahead of time, to avoid loading and stuttering during the game (the much-loved "compiling shaders" screen that many games have). Zombies no longer groan and roar after they have been shot, making things a little bit quieter after you have cleared out the horde.

While looking at the code for the custom sign, I realized that making a sign component would not be difficult, especially if I modeled it after the dialogue system and the extra data that is passed to the dialogue manager (like the player and NPC involved). Since a custom menu scene with a script is already used for the sign, it could fetch the sign entity from the data. That entity would have a sign component, with the title and text of the sign. The basic sign only has one button for now, the close button.

With signs using a component, it was not much more work to implement books using a similar system. There is now a book component which can be attached to an entity along with an action that opens a custom menu, using the basic book menu (or another one derived from it). The book component has a title like the sign, along with an array of multiline strings that support `[bbcode]` formatting (I may do Markdown or something later, but Godot has builtin support for bbcode). Each string in the array is one page in the book. The basic book menu has buttons to skip to the first, last, previous, and next page.

I added some options for a variety of debug visualizations in the cheats menu. This includes the navigation paths for the characters, markers to indicate their current behavior state, the radius of sound effects, and the stimuli that are perceived by the characters. This will help debug pathfinding and behavioral issues in the future. While I was working on debug tools, I added a few more console commands: `clear`, `give`, and `help`. These will clear the console history, add items to an entity's inventory, and print the list of available commands, respectively.

### Progress

- added support for signs with longer text
	- the sign component has a title and a multiline rich text field (bbcode is supported)
	- can be used with custom menus to create signs and interfaces that get data from the source entity or the player interacting with it
	- does not allow customizing the buttons through the component, that must be done through the sign's UI scene. This is for the simpler signs with a title, some text, and a close button.
- added support for books with multiple pages
	- the book component has a title and an array of pages
	- each page is a multiline rich text field (bbcode is supported)
	- the basic book menu has buttons for the first, previous, next, and last pages
	- the title and page counter will be shown
- set up a scene to help compile shaders and cache effects when the game loads
	- most of the editor options for compiling shaders are limited to the Forward+ renderer, while I am using the Compatibility renderer
	- there are some small, occasional stutters when a new effect spawns or a new weapon is used
	- this will play all of the effects when the game starts to avoid those stutters happening during gameplay
- fixed the zombies continuing to make noise after they were dead
	- they're always dead, but they kept groaning and roaring after they had been shot and collapsed
	- the fix will disable those timers when they die
- fixed the phantom baseball bat
	- items in your inventory were being frozen in kinematic mode and their collision shapes were not being disabled
	- the invisible-but-still-collidable inventory items were being shown in front of the player
	- I moved the inventory node behind the player and made sure the items were moved back to that point when they were unequipped
	- I made sure to freeze inventory items in static mode, where they won't collide while moving
	- your equipped weapons are still in kinematic mode so they can impact the world, as will some other items like shields
	- I need to work on helpers for the freeze/unfreeze code, to make sure that is consistent across the various code paths
- fixed the text on the debug sign (sort of)
	- it has real words now
- add collision helpers for disabling collision and freezing physics
	- this was being used in a few different places, with slightly varying parameters
- added a small "tech demo" label under the title
	- this is a demo of the technology with some levels that were created for this purpose
	- these are not the story levels that will used in the game Escape from Pinehaven
- added debug visualizations
	- FSM (behavior) state changes will be shown as a marker with the color based on the state and a small text label with the state name
	- sounds will be shown as green wireframe spheres
	- perception will be shown as a yellow line from the entity perceiving to the stimuli being perceived
	- navigation paths will be shown as a sequence of blue arrows, with a blue sphere at the destination
	- the player interaction raycast will be shown as a red and green line, with the red part showing the ray up to the first collision
	- these have to be enabled in the cheats for now, but I plan on adding a separate command to enable the debug visualizations
- move any references to `EditorInterface` into the zombie_tools editor addon
	- these break the release builds, which don't have an editor or its interface
- add more console commands
	- `clear`: clear the console history
	- `give`: give some items to an entity
	- `help`: show the list of console commands

### TODOs

Done.

### Next Up

- [ ] move actions into their own folder with conditions, triggers, mutations, etc
- [ ] start refactoring actions to use the context class
- [ ] quick save and quick load hotkeys
- [ ] the cars need to emit sounds more often or continuously (w.r.t attention)
- [ ] add a cause of death to the health/damage action (like "You fell in the lava...")
	- [ ] needs to be shown in the game over menu
- [ ] zombie equipment errors
	- `W 0:00:44:334   Logger.gd:49 @ log_level(): 2026-01-10T16:22:11 - WARNING - Unable to equip weapon: ZombieMelee
- [ ] remove mesh data from scenes
	- save the meshes into their own files and gitignore them for the public repo
- [ ] prepare the list of resource credits for the demo
	- [ ] freesound effects
	- [ ] itch assets
	- [ ] opengameart textures
	- [ ] editor icons
	- [ ] shaders
	- [ ] IKCC
	- [ ] figure out what else needs to be included
- [ ] start splitting up readme into sections
	- [ ] Itch link for players
	- [ ] game features for mod makers and players
    - [ ] new nodes for Godot developers
    - [ ] systems for GECS developers
- [ ] outline deep dives
    - [ ] level building for map makers
    - [ ] weapon building for mod makers
- [ ] add a scripted car with variable speed curve
	- [ ] should have a wait timer that starts when it comes to a stop, which can be the shuffle timer
- [ ] make melee weapons visible within the camera bounds at idle/resting position
- [ ] add shadows to the options menu
- [ ] add behavior for passive/unaware zombies
- [ ] push assets to a private repo
	- [ ] build automation
	- [ ] could use Github Actions if I give it credentials to download the assets bundle from somewhere
- [ ] make chests that you can open look different

### Ideas

- more signs with dynamic text
	- one that shows a summary of the player's experience and level, and/or inventory items
	- one that lets the player enter their own text and saves it in the component
- a clock sign ("seconds sign loading")
	- needs a script to count the seconds
- writing in books or on pages of paper
	- add a custom menu with text input and a save button that populates the sign/book component
- writing in "different languages" that prevent others from reading the text (like in Conan Exiles)
	- signs and books need a language component or key
- lens flare when you look at a light, especially bright flashlights
	- use a vision cone on the player, maybe?
	- or direct raycasts
	- apply an effect to each light that is sighted within that cone, based on the brightness and color of the light
	- could have a lens flare component with custom textures
	- basic flares should be drawn as 3D billboard sprites in the light prefab, this is for the blindness of looking into high beams on the highway
- if you can climb a ladder, you should be able to slide down a slide
	- a surface with a physics material with 0 friction
- convert console commands into a Dictionary with ["name", callable, "optional help"]
- menus should be updated by a menu observer/system or action handlers
	- this would get rid of the weird menu sync in the entity when the player entity spawns

### Signs with Custom Text

I have a way to show signs already using a preconfigured menu scene, which can do menus with complex interactions but cannot take any parameters from the entity that triggered it. I think it would be useful to have a text component, or maybe a details field on the interactive component, that could store some rich text for things like ingame signs, menus (the restaurant kind), or books.

- figure out how signs can show text from a component
	- the entity that triggers the sign could be provided
	- this should be handled essentially like dialogue, with the source and actor both being passed to the menu
	- the custom menu scene is not instantiated in time to set those
	- this would make more sense if we had an action context class, then it could be the custom menu's context as well
		- the menu action will have an action context, naturally, and could pass it through
		- if not an action context, it could be a dialogue context

If the custom menu is launched with a copy of the action context shown below, then both of the entities involved in opening the menu will be available for the menu script. This needs to be passed through using some predictable field or method. It would be nice to send that as part of `on_show()` or `on_update()`, but neither of them take any parameters at the moment and a child class cannot add parameters to a method defined in the parent.

Until the action context is integrated, I am passing the data through to the custom menu using a dictionary, which is the same way that the dialogue manager handles it. That seems to work well enough, and the script attached to the sign's UI scene is able to get a component from the sign, which has the title and text to be shown.

Because the sign data is stored in a component, it can be used and modified by other scripts. Because the sign script has access to the player, it can show data about them, like current level, experience, or currency.

### Action Context

As I build more action nodes, there have been a few cases where it would be nice to pass some additional data from the trigger to the actions and conditions. I've switched the order of the parameters in the signature already once or twice, and I want to avoid doing that repeatedly, so I've been working on a context class that can hold a variety of different pieces of data and pass them together, using a single parameter and named fields. This will be easier to work with in a lot of ways, like branches that change the source or actor can pass a new context to their children.

Yesterday's devlog had a rough pseudo-code version of the context class, but I have something more solid today:

```
extends RefCounted
class_name ActionContext
## Encapsulates the context for an action execution, including the action event type,
## source and target actors, the menu state, and arbitrary action data.


## Represents an actor involved in an action (either source or target).
## Contains references to the underlying entity, physics body, node hierarchy, and collision shape.
class ActionActor extends RefCounted:
	## The Entity component representing this actor (if applicable).
	var entity: Entity

	## The PhysicsBody3D node this actor is associated with (if applicable).
	var body: PhysicsBody3D

	## The general Node reference for this actor (can be any node type).
	var node: Node

	## The CollisionShape3D node associated with this actor (if applicable).
	var shape: CollisionShape3D


## Represents the menu state and UI control associated with an action.
class ActionMenu extends RefCounted:
	## The base menu instance (ZM_BaseMenu) if a menu is active.
	var menu: ZM_BaseMenu

	## The Control node representing the UI element that was interacted with.
	var control: Control


## The type of action event being executed.
var event: Enums.ActionEvent

## The actor initiating the action.
var trigger: ActionActor = null

## The actor targeted by the action.
var actor: ActionActor = null

## The menu context associated with this action (if applicable).
var menu: ActionMenu = null

## Arbitrary key-value data storage for action-specific parameters and state.
var data: Dictionary[String, Variant] = {}
```

While a bit verbose, I think the accurately captures the idea of one node triggering an action on another, although `source` and `target` are still not good names. I am debating using `trigger` and `actor`, or keep using `source` and `actor`, but I'm not sure if there is a good solution to that naming.

The big additions here are the `menu` for actions that are triggered from within a menu and `data` for additional fields that need to be passed with a specific type of action. For example, when the FSM emits actions while entering or exiting a state, it can include the old and new states. That will allow the actions to run different branches depending on the state, so the zombie can roar when it enters the chase or attack states.

#### Update 1

After deliberating on the property names for a while, I have settled on `trigger` and `subject` for now. When the action was caused by a player interaction, the `trigger` will be the entity that you interacted with and the `subject` will be the player doing the interaction. When the action was caused by a trap, the `trigger` is more literal, being the tripwire or pressure plate that triggered the trap.

While I liked `source` and `actor`, they can both be ambiguous in some circumstances, so I'd rather use something that has fewer meanings in order to clarify who the properties are referring to.

### More Player Testing

- Player was not managing stamina at first (need that exhaustion sound)
- Balance the crowbar, more damage to enemies and less durability damage
- Bullet holes are showing up on invisible walls (clip walls)
- Crowbar doesn't hit the cardboard box in the water
- Crowbar is using the bat broken sound when it breaks
- Player missed the message about getting an item from the crate (color code or add a sound)
- Shotgun has too much physics again, pushing medkits through the floor
- Need to limit how far adaptive aim can turn the gun (on the close end)
- Curb near the red car in the bus stop level is weird, can't walk up it sometimes, the effect stops at the vertical line on the brick building
- Buttons on the new save menu are positioned wrong
- Creating a new save with an existing name does not ask if you want to replace the old one
