### Summary

I made the fishing pier larger and added a door on the balcony. I added portals to the spooky church and bus stop levels with markers for return portals. I added a phone book that opens the level select (using the clipboard from the PSX Gifts & Misc pack) and a red save page to the spooky church (using the open book from PSX mega pack with a red spot light above it).

I fixed several bugs: switching throwable weapons when you run out was broken because equip_weapon now returns a boolean rather than the old weapon. Weapon scrolling was getting stuck when you have rocks and pistol - if the current weapon doesn't have a shortcut, I now use the order in the inventory list. The ammo label was not updating after equipping items through the inventory menu.

I improved the check level structure tool to make sure no entities are outside the entities node and check for components with weird node paths. I fixed the "Unable to equip weapon: ZombieMelee" log spam - some zombies had lost their weapon equipment slot. I fixed errors when the player dies due to fire, fixed stamina not draining while sprinting (broken logic was skipping entities with full stamina), and fixed the style on the resume button in the pause menu.

I started the player with full stamina and removed the "no matching environment" warning in some levels.

I did a quick interview with a potential player who is somewhat familiar with the genre, asking for the top 10 concepts they associated with zombie games. Based on that feedback, I plan to add a door to the fishing pier hut with a zombie inside, radio static from the running car, sounds to the zombies, and find a way to have zombies jump through windows.

### Progress

- [x] make fishing pier larger
	- extend the road so that the car is always on it?
	- [x] add a door on the balcony
	- [x] add portals to the spooky church and bus stop levels
	- [x] add markers for the return portals
	- [x] add a phone book that opens the level select
		- used the clipboard from the PSX Gifts & Misc pack
- [x] add a red save page to spooky church
	- used the open book from PSX mega pack
	- with a red spot light above it
- [x] add a portal to the spooky church
	- [x] add a street sign in front
	- [x] add a marker for the fishing pier portal
- [x] add a portal to the bus stop
	- [x] replace the existing mailbox
	- [x] add a marker for the fishing pier portal
- [x] switching throwable weapons when you run out is broken
	- `equip_weapon` now returns a boolean rather than the old weapon
- [x] start player with full stamina
- [x] weapon scrolling can get stuck when you have the rocks and pistol
	- don't have much more info on this one yet, need to work on the repro
	- the rocks do not have a shortcut, the pistol is shortcut 3
	- if the current weapon doesn't have a shortcut, I need to find something else to provide the order
		- could use the order in the inventory list, which is fairly stable
		- or turn off the previous/next feature for weapons that don't have a shortcut
- [x] update ammo label after equipping an item through the inventory menu
	- there are a few places where equipping or switching items does not update the ammo label correctly
- [x] in the check level structure tool:
	- [x] make sure no entities are outside of the entities node
	- [x] check for components with weird node paths that would lead outside of the scene and then back to the root, like `Node not found: "../WeaponShotgun/Shotgun"`
		- this check is implemented, but it's not finding any NodePath properties
		- the `PROPERTY_USAGE_SCRIPT_WHATEVER` was not working, the correct mask appears to be 6 (`PROPERTY_USAGE_STORAGE | PROPERTY_USAGE_EDITOR`)
- [x] fix the "Unable to equip weapon: ZombieMelee" log spam
	- the zombies kept trying to equip their melee weapon even when it was already equipped
	- some of the zombies had lost their weapon equipment slot
	- I adjusted some of the `switch_weapon` code (which needs to be a helper) to avoid equipping twice
	- I can no longer reproduce the error message while playing through the demo levels
- [x] fix the errors when the player dies
	- when the player dies due to fire, the killer name message breaks with an error: `ZO_HealthObserver._on_death: Invalid access to property or key 'name' on a base object of type 'Nil'.`
- [x] stamina not draining while sprinting
	- there was some broken logic that caused the stamina system to skip any entity with full stamina
- [x] fix the style on the resume button in the pause menu
	- adjusted the button so that the green background also has rounded corners
- [x] fix or remove the "no matching environment" warning in some levels

### TODOs

- [ ] zombies are not chasing very well
	- sometimes they are slow and easily distracted
- [ ] zombies are attacking each other
	- does not need to be fixed, necessarily

### Next Up

- remove mesh data from scenes
- set up the laptop for potato testing
- make sure player can't interact with items through a wall
- consider linking the bus stop and spooky church
	- need to find a sign or prop for that
- consider using the hotel for the main menu background
- research whether shimmer and interactive should be separated
	- shimmer needs access to the inner scene tree while interactive does not
	- could add a boolean enabled flag to the shimmer component rather than adding/removing it
	- interactive name is the most likely to be changed in the level
	- shimmer could have an always on flag as an alternative to proximity
	- always on with a toggle action and a trigger area becomes proximity

### Player interview Todos

Did a quick interview with a potential player who is somewhat familiar with the genre. Asked for the top 10 concepts that they associated with zombie games, trying to avoid any specific setting or plot.

The changes based on that:

- add a door to the fishing pier hut with a zombie inside
- add radio static from the running car in the bus stop level
- add sounds to the zombies, moaning and groaning
- find a way to have a zombie jump through a window or fall off the balcony when you get close
- worker zombie turns light on during chase state?

### Item Shortcuts

I ran into some edge cases with the item shortcut system that needed to be addressed.

There are two problems with the new item shortcut system: gaps (shortcuts without an item) and intruders (items without a shortcut).

The logic for switching weapons is pretty simple:

1. check if the player has a weapon equipped
2. if they do, get its shortcut
3. if the weapon does not have a shortcut, jump to the start or end of the list
4. move to the next (or previous) shortcut in a looping list
5. find a weapon with that shortcut
6. if one exists, equip it

This happy-path is easy and works well, but there are a lot of ifs in that list:

1. If the player has a weapon equipped
2. If the weapon has a shortcut
3. If a weapon exists for the next/previous shortcut

Those conditions also have different solutions:

1. If the player does not have a weapon equipped, start with their first shortcut (for the next button) and last shortcut (for the previous button)
2. If the weapon does not have a shortcut, we can do the same as in #1
3. If no weapon exists for the next/previous shortcut, move to the shortcut after that and continue until you have looped around the list

If the player does not have a weapon equipped, then it makes sense for next and previous to jump to the first or last weapon.

If the current weapon does not have a shortcut, this is harder. Jumping to the beginning or end of some arbitrary list does not make much sense, but having the next/previous weapon inputs suddenly stop working is not a great experience either. Moving through the whole inventory could work, until you come across a weapon that does have a shortcut, which switches you from the all-inventory mode back into the shortcuts mode without any warning.

There are a few possible solutions to this:

1. Make sure all of the weapons have shortcuts
	1. Guarantees that if you're holding a weapon, it always has a shortcut
	2. This is a problem if you ever want to customize or remove shortcuts
	3. Still need to loop around the list if shortcuts are empty
2. Treat no weapon and no shortcut the same way
    1. Could be communicated to the player with icons
    2. Not the most intuitive, but it is easy to explain

What case am I really trying to solve?

- when you have two weapons, one with a shortcut and one without, the next/ previous options get stuck on the one with the shortcut
- shortcuts could be for the number keys only, and next/previous could go through your whole inventory
- in a simple Quake/Unreal/Wolfenstein style game, you get weapons in order and they all have shortcuts
- in more complex games, you would probably have a hotbar that both mapped to
- if you had a hotbar, then the current selection would be mapped to an item there
- not having that state outside of the current weapon is a problem


Solution:  next and previous scroll through your whole inventory. Shortcuts use the inputs. I may add that as a gameplay option layer, but if it really becomes a problem, I'll switch to a hotbar system.

In the hotbar sysyem, You will have some number slots (which traditionally increases as the game progresses), you can assign one or more items to each slot, and both the scrolling and shortcut inputs will be limited to those slots. That can have an option to skip empty slots, which makes sense in a level-progression shooter, or stop on empty slots, which allows you to holster your weapon and fits better with some common input patterns (todo: citation needed).

Setting up a hotbar right now would require icons for all of the items, which is a rabbit hole that I want to explore, but after I publish the demo on Itch. There are some good options for taking screenshots in the Godot editor.
t editor.

### ZombieMelee Log Warnings

There was a bug causing log spam about zombies trying to equip their melee weapon repeatedly.

Zombies were equipping their weapon every tick when they were in the attack and chase states. Added some logic so that they only equip once, if they don't have anything else equipped. One of the zombie prefabs had also lost its equipment slot, which I added back.

### Updating the Ammo Label

I ran into issues where the ammo label in the HUD was not being updated correctly after certain actions.

Keeping the ammo label updated has been oddly difficult, because a few different events can add or remove ammo from the player. They are all managed through the player system one way or another, so the update code has been kept there, but that prevents any other menus from updating the label. In particular, this has been a problem when the inventory menu switches the weapon, which has not been updating the label.

Moving the label formatting logic into the menu scripts seems like a good idea, but I'm not sure if the inventory menu should look at what kind of item is being equipped and update the ammo label. Having that in a more central place like `equip_item` or `switch_weapon` feels more appropriate. There are other checks that will be needed before equipping an item, like making sure it is loaded (once that option is implemented) or in a game with levels, checking if the player has a high enough level.
