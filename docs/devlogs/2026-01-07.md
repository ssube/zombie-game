### Summary

I am working on polishing the first three levels for the demo and going through looking for any big bugs that are lingering in the dark corners.

I found two such bugs today and put fixes in place for both of them:

1. Players could interact with items through walls
2. The character controller was not working and players could not climb curbs or stairs

The first one was pretty simple: the interaction with items uses a ray cast in front of the player, which was not colliding with the world geometry. That allowed you to reach through walls and grab items on the other side. I fixed this by changing the collision mask.

The second was more interesting. When integrating the IKCC controller with the GECS entity, I renamed some variables that were marked as colliding with the native variables or methods, but the problem was in the inheritance (or a compiler glitch) and those variables were intended to override the existing ones. I reverted the names back to the originals and the advanced character controller seems to be working. You can walk up curbs and stairs again.

This wasn't exactly a bug, but doors and barrels were using the wrong scale. The doors were 2 meters wide and 4 meters tall (6 feet by 13 feet). I scaled those down to something more realistic and fixed the map geometry around them. The doors are still large enough for the player to walk through without getting stuck on things.

I added two new events to the actions: item equip and item unequip. They are called when an item is equipped or unequipped, as you might be able to guess. Because of the way that Godot handles signals, the actions cannot cancel either of these events, but an event handler could call the opposing method to make items that can't be equipped or removed. These were used to fix the fishing hat on the fishing pier level, which now only activates the underwater effect when you are wearing it (not when you stand on it).

I split up the interaction and shimmer components, which were already being handled by different systems. I was having to duplicate the whole component in order to rename some of the interactive signs, which meant copying the shimmer parameters too. Splitting them up means that you can make items that shimmer without being interactive or vice versa. This will also make it easier to add a shimmer action to enable and disable the effect based on a trigger, which will allow me to make objects that shimmer when you are near them.

I added a stamina cost penalty when running up stairs or ramps and when jumping. This increases stamina consumption based on how vertically you are traveling, so sprinting up stairs uses 2x as much stamina as sprinting on flat ground. This ratio can be tweaked layer, but I think this will help make stamina consumption more realistic and will match your movement better since you move much more slowly going uphill.

After doing a quick player interview last night where I asked what the top 10 things that they associated with zombie games were, the feedback that I had not implemented yet was mostly around jump scares, spooky ambience, and TODO. To that end, I added a zombie inside the shack or cabin at the end of the fishing pier, who will confront you when you go looking for the magnum pistol. I also added a proper jump scare to the spooky church, with a sudden noise and physics effect. Finally, the stopped car on the bus stop level now has a loop of radio static playing inside.

I added more noise to the zombies, both random noises that they will make while idle and roaring that is linked to their attacking behavior state. This makes being up close to the zombies a lot more immersive and visceral.

I added more grass to all of the levels, and implemented the drop button in the inventory menu.

### Progress

- [x] make sure player can't interact with items through a wall
	- you totally could
	- fixed by adding the world layer to the collision mask for the player's interaction ray (the raycast that figures out what you are looking at)
- [x] feedback from player interview:
	- [x] add a door to the fishing pier hut with a zombie inside
	- [x] add radio static from the running car in the bus stop level
	- [x] add sounds to the zombies, moaning and groaning
	- more jump scares
		- [x] open a door and there is a zombie behind it (done: fishing pier hut)
		- [x] something falls and makes a noise (in the spooky church)
- [x] bug: you get a water effect from touching the fishing hat
	- because the hat uses a trigger area to enable the effect, which normally triggers when the player is wearing it but also triggers if they step on it
	- only activating the area when the hat is equipped could work
	- added item-equip and item-unequip action events
	- implemented those events in the equip helper
- [x] scale:
	- [x] doors are way too big (2x4 meters)
		- real doors are about 1x2, give or take
		- reducing the doors to 1.5x2.5 allows the player and other characters to pass through comfortably, without making the controls difficult
			- map size: 6x10 on the grid 16 setting
		- [x] fix map doorways
			- [x] fishing pier
			- [x] debug level 0
			- [x] debug level 1
	- [x] barrels are too big
		- [x] explosive
		- [x] fire
- [x] the breakable glass no longer has a label
- [x] put signs in each of the debug rooms
- [x] make the fish hat more visible for the player
- [x] add more magnum ammo to the fishing pier
	- [x] across the road
	- [x] under the pier
- [x] level select menu on the pier is not working
- [x] add some lighting to the spooky church
- [x] picking up the pistol makes the shotgun sound
- [x] make sure all curbs and stairs are walkable
	- [x] bus stop
		- [x] curbs
	- [x] fishing pier
		- [x] curbs
		- [x] beach stairs
	- [x] spooky church
		- [x] front stairs
- [x] make the flare item smaller
- [x] fix jumping
- [x] fix the IKCC controller in general
- [x] consume stamina faster when you are moving up stairs
- [x] implement the drop item button in the inventory menu
- [x] decrease how much the zombies reduce the crowbar's durability
- [x] this error: `E 0:00:26:980   RelationshipUtils.gd:64 @ get_wielder(): Index p_index = 0 is out of bounds (p_instance->size() = 0).`
	- this is happening when the moving car on the fishing pier level hits someone
	- the health/damage action is looking for the entity that is wielding the car, but the area is not/cannot be wielded
	- the code downstream in the health action is set up to handle the entity not having a wielder
	- fixed by adding support for damage areas that are not part of a weapon (the car bumper, a plant with spikes, etc)
- [x] consistent casing for subtitles
- [x] more grass on all of the levels
	- [x] fishing pier - on the beach, between buildings
	- [x] spooky church - in the yard
	- [x] bus stop - curbs, between buildings
- [x] split up the shimmer and interact components
	- [x] the shimmer component has the material and nodes, plus an enabled flag
	- [x] the interactive component has the name and pickup flag
	- [x] the shimmer observer watches for the flag changing rather than the component being added/removed
	- [x] the player system may need to be updated
	- [x] add the shimmer component to everything that used to have it
- [x] make the shimmer colors match the crosshair and other UI colors
- [x] add a zombie roar when they attack
	- [x] add a debounce action
	- [x] add the sound into their behavior
- [x] fix zombies roaring when the level loads
	- they were detecting themselves within their own attack radius, which is technically correct
	- turned off detection of mobs within the zombie attack radius
- [x] link the zombie sounds to their behavior states
	- they will roar when they start attacking

### Next Up

- only enable sparkle crown while worn
- the zombie equipment errors are still happening somewhat often
	- except when I'm trying to reproduce them
- set up the laptop for potato testing
- figure out where the crosshair settings should go (probably into their own component)
- zombies are not smoothly turning to follow the player
	- they turn in chunks, somewhat strangely
- add more static foliage
	- a bush
	- a dead tree
- fix the glass material on the bus stop level
- make sure you can't reach the pistol through the window of the fishing pier cabin
- commit the materials in the textures folder
- remove mesh data from scenes

### Ideas

- add a way for the FSM to call actions when it enters/exits a state
- worker zombie turns light on during chase state - maybe v2
- find a way to have a zombie jump through a window or fall off the balcony when you get close - maybe v2
